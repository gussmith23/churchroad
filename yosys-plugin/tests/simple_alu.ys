# RUN: $YOSYS -m $CHURCHROAD_DIR/yosys-plugin/churchroad.so %s \
# RUN: | FileCheck %s

read_verilog -sv simple_alu/alu.sv;
prep -top alu;
hierarchy -check -top alu;
splice; splitnets -driver;
clean;
techmap;
dfflibmap -liberty simple_alu/mycells.lib;
abc -liberty simple_alu/mycells.lib;
read_verilog simple_alu/mycells.v;

flatten;
splice; splitnets -driver;
clean;

#write_verilog out/alu_synth.v
#write_rtlil out/alu_synth.rtlil
write_lakeroad

# CHECK: (let v0 (Wire "v0" 1))
# CHECK: (let v1 (Wire "v1" 1))
# CHECK: (let v2 (Wire "v2" 1))
# CHECK: (let v3 (Wire "v3" 1))
# CHECK: (let v4 (Wire "v4" 1))
# CHECK: (let v5 (Wire "v5" 1))
# CHECK: (let v6 (Wire "v6" 1))
# CHECK: (let v7 (Wire "v7" 1))
# CHECK: (let v8 (Wire "v8" 1))
# CHECK: (let v9 (Wire "v9" 1))
# CHECK: (let v10 (Wire "v10" 1))
# CHECK: (let v11 (Wire "v11" 1))
# CHECK: (let v12 (Wire "v12" 1))
# CHECK: (let v13 (Wire "v13" 1))
# CHECK: (let v14 (Wire "v14" 1))
# CHECK: (let v15 (Wire "v15" 1))
# CHECK: (let v16 (Wire "v16" 1))
# CHECK: (let v17 (Wire "v17" 1))
# CHECK: (let v18 (Wire "v18" 2))
# CHECK: (let v19 (Wire "v19" 1))
# CHECK: (union v0 (Op1 (Extract 1 1) v18))
# CHECK: (union v2 (Op1 (Extract 0 0) v18))
# CHECK: (union v1 (Op1 (Not) v0))
# CHECK: (union v3 (Op1 (Not) v10))
# CHECK: (union v10 (Op2 (Or) v2 v16))
# CHECK: (union v4 (Op2 (Xor) v2 v16))
# CHECK: (union v5 (Op1 (Not) v11))
# CHECK: (union v11 (Op2 (Or) v17 v4))
# CHECK: (union v6 (Op1 (Not) v12))
# CHECK: (union v12 (Op2 (Or) v1 v16))
# CHECK: (union v7 (Op2 (And) v1 v17))
# CHECK: (union v8 (Op1 (Not) v13))
# CHECK: (union v13 (Op2 (Or) v6 v7))
# CHECK: (union v9 (Op1 (Not) v14))
# CHECK: (union v14 (Op2 (Or) v3 v8))
# CHECK: (union v19 (Op1 (Not) v15))
# CHECK: (union v15 (Op2 (Or) v5 v9))
# CHECK: (let i_a (Var "i_a" 1))
# CHECK: (IsPort "" "i_a" (Input) i_a)
# CHECK: (union v16 i_a)
# CHECK: (let i_b (Var "i_b" 1))
# CHECK: (IsPort "" "i_b" (Input) i_b)
# CHECK: (union v17 i_b)
# CHECK: (let i_control (Var "i_control" 2))
# CHECK: (IsPort "" "i_control" (Input) i_control)
# CHECK: (union v18 i_control)
# CHECK: (let o_res v19)
# CHECK: (IsPort "" "o_res" (Output) o_res)
# CHECK: (delete (Wire "v0" 1))
# CHECK: (delete (Wire "v1" 1))
# CHECK: (delete (Wire "v2" 1))
# CHECK: (delete (Wire "v3" 1))
# CHECK: (delete (Wire "v4" 1))
# CHECK: (delete (Wire "v5" 1))
# CHECK: (delete (Wire "v6" 1))
# CHECK: (delete (Wire "v7" 1))
# CHECK: (delete (Wire "v8" 1))
# CHECK: (delete (Wire "v9" 1))
# CHECK: (delete (Wire "v10" 1))
# CHECK: (delete (Wire "v11" 1))
# CHECK: (delete (Wire "v12" 1))
# CHECK: (delete (Wire "v13" 1))
# CHECK: (delete (Wire "v14" 1))
# CHECK: (delete (Wire "v15" 1))
# CHECK: (delete (Wire "v16" 1))
# CHECK: (delete (Wire "v17" 1))
# CHECK: (delete (Wire "v18" 2))
# CHECK: (delete (Wire "v19" 1))